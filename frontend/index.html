<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R.I.Z.A.L.</title>

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <link rel="icon" href="./src/assets/icon.png" type="image/png">
    <link rel="stylesheet" href="./src/css/style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>

<body>
    <div class="background-wrapper">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div class="app-container">

        <div class="header-logos" id="logoContainer">
            <img src="./src/assets/icon.png" alt="Logo 1" class="logo-icon">
            <img src="./src/assets/jrmsu_icon.png" alt="Logo 2" class="logo-icon">
        </div>

        <section id="slide-1" class="slide active">
            <div class="content">
                <h1>Welcome, <br> <span class="highlight">Illustrados</span></h1>
                <p class="description">
                    <span class="highlight">R</span>ecord & <span class="highlight">I</span>ntegrated <span
                        class="highlight">Z</span>one for <span class="highlight">A</span>ttendance & <span
                        class="highlight">L</span>ogging (R.I.Z.A.L.) is designed to simplify your daily attendance
                    monitoring at JRMSU. Track your records and stay informed.
                </p>
                <button class="btn-primary" onclick="nextSlide(2)">Next</button>
            </div>
        </section>

        <section id="slide-2" class="slide">
            <div class="content">
                <h1>Do you <br> <span class="highlight">Agree?</span></h1>
                <p class="description">
                    By continuing, you confirm that you have read, understood, and agreed to the
                    <a href="#" onclick="document.getElementById('pdfViewer').style.display='block'">
                        Terms of Service</a> and <a href="#"
                        onclick="document.getElementById('pdfViewer').style.display='block'"> Privacy Policy</a>.
                </p>
                <button class="btn-primary" onclick="nextSlide(3)">Agree & Continue</button>
            </div>
        </section>

        <section id="slide-3" class="slide">
            <div class="content">
                <h1>Log <span class="highlight">In.</span></h1>

                <form id="loginForm">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter your email">
                    </div>

                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="Enter your password">
                    </div>
                    <a href="#" class="forgot-pass">Forgot Password?</a>
                    <div class="g-recaptcha" data-sitekey="6LcwPGYsAAAAAJM344gXtvBszYY0hIY69zaavxaH" data-theme="dark"
                        style="margin-bottom: 1rem; transform:scale(0.85); transform-origin:0 0;">
                    </div>
                    <button type="button" class="btn-primary" onclick="validateLogin()">Log In</button>
                    <button type="button" class="btn-secondary" onclick="createAccount()">Create Account</button>

                </form>
            </div>
        </section>

        <section id="slide-4" class="slide">
            <div class="content">
                <h1>Face <span class="highlight">Scan.</span></h1>
                <p class="description">
                    Please look at the camera to verify your identity.
                </p>

                <div class="scanner-wrapper">
                    <video id="webcam" autoplay playsinline muted></video>

                    <div class="scan-overlay">
                        <div class="scan-line"></div>
                    </div>
                </div>

                <p id="scanStatus" style="color: #ccc; font-size: 0.9rem; margin-top: 1.5rem; text-align:center;">
                    Initializing Camera...
                </p>
            </div>
        </section>

        <div class="pagination-container">
            <span class="dot active" id="dot-1"></span>
            <span class="dot" id="dot-2"></span>
            <span class="dot" id="dot-3"></span>
        </div>

        <!-- Developer Credit -->
        <div class="dev-credit" id="devCredit">
            Developed by <span class="dev-credit-link" onclick="openDevModal()">ByteForce</span>
        </div>

    </div>

    <!-- Developer Modal -->
    <div class="dev-modal-overlay" id="devModalOverlay" onclick="closeDevModal()">
        <div class="dev-modal" onclick="event.stopPropagation()">
            <button class="dev-modal-close" onclick="closeDevModal()">&times;</button>

            <!-- Single View Content -->
            <div class="modal-content-container">
                <!-- Branding -->
                <div class="team-brand">
                    <div class="team-logo">âš¡</div>
                    <h2 class="team-name">Byte<span class="highlight">Force</span></h2>
                    <p class="team-tagline">The people behind R.I.Z.A.L.</p>
                    <div class="team-divider"></div>
                    <p class="team-desc">We build smart solutions for modern campuses. Innovation through code.</p>
                </div>

                <!-- Grid -->
                <h3 class="slide-heading" style="margin-top: 2rem;">The <span class="highlight">Team</span></h3>
                <div class="dev-grid">
                    <div class="glass-card has-preview" data-glass="card1">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member1.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Gabriel Anthony Tolentino</span>
                            <span class="dev-role">Scrammer</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Responsible for facilitating agile processes, removing
                                    blockers, and ensuring the team delivers efficiently.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com/100077976213350/" target="_blank"
                                    class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card2">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member2.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Member 2</span>
                            <span class="dev-role">Project Manager</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Responsible for project scheduling, feature prioritization,
                                    and team coordination to deliver a responsive web application.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com" target="_blank" class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card3">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member3.jpg" alt="Developer">
                            </div>
                            <span class="dev-name">Gloryzann H. Aclao</span>
                            <span class="dev-role">Front End Developer</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Tasked with crafting responsive user interfaces,
                                    implementing dynamic interactions, and ensuring a smooth experience across all
                                    devices.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.linkedin.com/in/gloryzann-aclao-025421366/" target="_blank"
                                    class="preview-contact linkedin">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z" />
                                    </svg> LinkedIn
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card4">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member4.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Member 4</span>
                            <span class="dev-role">Backend Developer</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Responsible for developing and maintaining server-side
                                    logic, managing database interactions, and ensuring secure data flow across the
                                    system.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com" target="_blank" class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card5">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member5.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Member 5</span>
                            <span class="dev-role">Asst. Backend Developer</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Assists in building APIs, handling data models, and
                                    supporting the lead backend developer in system architecture decisions.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com" target="_blank" class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card6">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member6.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Member 6</span>
                            <span class="dev-role">QA Tester</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Tasked with verifying functionality, identifying UI/UX
                                    issues, and ensuring a consistent experience across devices and browsers.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com" target="_blank" class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card has-preview" data-glass="card7">
                        <div class="glass-card-inner">
                            <div class="dev-avatar has-img">
                                <img src="./src/assets/dev/member7.jpg" alt="Developer"
                                    onerror="this.src='./src/assets/dev/member3.jpg'">
                            </div>
                            <span class="dev-name">Member 7</span>
                            <span class="dev-role">Documentation</span>
                            <div class="dev-preview">
                                <p class="preview-desc">Responsible for writing technical documentation, user
                                    guides, and maintaining project records for future reference.</p>
                                <span class="preview-course">BSCPE 2</span>
                                <a href="https://www.facebook.com" target="_blank" class="preview-contact">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                    </svg> Facebook
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. SLIDER LOGIC (Keep as is) ---
        function nextSlide(slideNumber) {
            // 1. Hide all slides
            document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
            document.getElementById('slide-' + slideNumber).classList.add('active');

            // 2. Move the Logos (Keep up for Slide 3 & 4)
            const logos = document.getElementById('logoContainer');
            if (slideNumber >= 3) logos.classList.add('move-up');
            else logos.classList.remove('move-up');

            // 3. Handle Dots & Credit
            const pagination = document.querySelector('.pagination-container');
            const devCredit = document.getElementById('devCredit');

            if (slideNumber === 4) {
                // HIDE dots and credit on Face Scan slide
                pagination.style.display = 'none';
                if (devCredit) devCredit.style.display = 'none';
            } else {
                // SHOW dots and credit on all other slides
                pagination.style.display = 'flex';
                if (devCredit) devCredit.style.display = 'block';

                // Update active dot
                document.querySelectorAll('.dot').forEach(dot => dot.classList.remove('active'));
                const activeDot = document.getElementById('dot-' + slideNumber);
                if (activeDot) activeDot.classList.add('active');
            }
        }

        // --- 2. LOGIN VALIDATION (Keep as is) ---
        function validateLogin() {
            var response = grecaptcha.getResponse();
            if (response.length === 0) {
                alert("Please check the 'I'm not a robot' box.");
            } else {
                nextSlide(4);
                startRealFaceDetection(); // CALL THE NEW FUNCTION
            }
        }

        // --- 3. REAL FACE DETECTION LOGIC ---
        let detectionInterval; // Variable to stop the scanner later

        async function startRealFaceDetection() {
            const video = document.getElementById('webcam');
            const statusText = document.getElementById('scanStatus');
            const scannerWrapper = document.querySelector('.scanner-wrapper');

            statusText.innerText = "Loading AI Models...";

            // A. LOAD THE AI MODELS (From a public CDN for now)
            try {
                await faceapi.nets.tinyFaceDetector.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights');
                // If models load, start camera
                startCamera();
            } catch (err) {
                console.error(err);
                statusText.innerText = "Error loading AI. Check internet.";
                statusText.style.color = "red";
            }

            // B. START CAMERA
            function startCamera() {
                navigator.mediaDevices.getUserMedia({ video: {} })
                    .then(stream => {
                        video.srcObject = stream;
                        statusText.innerText = "Looking for a face...";
                    })
                    .catch(err => console.error(err));
            }

            // C. ON VIDEO PLAY -> START DETECTING
            video.addEventListener('play', () => {
                const canvas = faceapi.createCanvasFromMedia(video);
                const displaySize = { width: video.width || 220, height: video.height || 220 };
                faceapi.matchDimensions(canvas, displaySize);

                let attempts = 0;
                const maxAttempts = 50; // Roughly 5 seconds (50 * 100ms)

                detectionInterval = setInterval(async () => {
                    // 1. SCAN FOR FACES
                    const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions());

                    if (detections.length > 0) {
                        // --- FACE DETECTED! ---
                        clearInterval(detectionInterval); // Stop scanning

                        scannerWrapper.style.borderColor = "#00e676"; // Green
                        statusText.innerText = "Face Detected! Verifying...";
                        statusText.style.color = "#00e676";

                        // Wait 1 second then success
                        setTimeout(() => {
                            alert("Access Granted! (Face Found)");
                            // Stop Camera
                            video.srcObject.getTracks().forEach(track => track.stop());
                            // window.location.href = "dashboard.html"; 
                        }, 1000);

                    } else {
                        // --- NO FACE YET ---
                        attempts++;
                        statusText.innerText = "Searching... Please look at camera.";

                        // IF TIME RUNS OUT (5 Seconds)
                        if (attempts > maxAttempts) {
                            clearInterval(detectionInterval); // Stop scanning

                            scannerWrapper.style.borderColor = "#ff4444"; // Red
                            statusText.innerText = "No Face Detected. Try Again.";
                            statusText.style.color = "#ff4444";

                            // Optional: Add a "Retry" button logic here
                            // For now, reload to try again
                            setTimeout(() => {
                                if (confirm("Scan Failed. Try again?")) {
                                    startRealFaceDetection(); // Restart
                                }
                            }, 1000);
                        }
                    }
                }, 100); // Check every 100ms
            });
        }

        // --- 4. DEVELOPER MODAL LOGIC ---
        function openDevModal() {
            document.getElementById('devModalOverlay').classList.add('active');
            // Removed modalSlide(1) since there is no slider anymore
            // modalSlide(1); 
        }
        function closeDevModal() {
            document.getElementById('devModalOverlay').classList.remove('active');
        }
        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeDevModal();
        });

        // --- 4b. MODAL SLIDER (REMOVED) ---
        // function modalSlide(num) {
        //     document.querySelectorAll('.modal-slide').forEach(s => s.classList.remove('active'));
        //     document.querySelectorAll('.modal-dot').forEach(d => d.classList.remove('active'));
        //     document.getElementById('modalSlide' + num).classList.add('active');
        //     document.getElementById('modalDot' + num).classList.add('active');
        // }

        // --- 5. CREATE ACCOUNT (Backend-ready placeholder) ---
        function createAccount() {
            // TODO: Replace with navigation to registration page or API call
            // Example: window.location.href = "register.html";
            alert("Create Account page coming soon!");
        }
    </script>

    <div id="pdfViewer" style="
        display:none;
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:white;
        z-index:9999;
        ">
        <div style="padding:10px;">
            <button onclick="document.getElementById('pdfViewer').style.display='none'">
                Close
            </button>
        </div>

        <iframe src="./src/RIZAL_Terms_and_Privacy.pdf" width="100%" height="90%">
        </iframe>
    </div>
</body>

</html>